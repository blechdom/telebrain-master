
<html></html>
<body>
  <table width="100%" border="1">
    <tr>
      <td width="75%">
        <pre><code><span class="k">var</span> utils <span class="k">=</span> require<span class="k">(</span><span class="s">'./connection_utils'</span><span class="k">),</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>  inherits <span class="k">=</span> require<span class="k">(</span><span class="s">'util'</span><span class="k">).</span>inherits<span class="k">,</span></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse perfectly aligned message from socket<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>  net <span class="k">=</span> require<span class="k">(</span><span class="s">'net'</span><span class="k">),</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>  EventEmitter <span class="k">=</span> require<span class="k">(</span><span class="s">'events'</span><span class="k">).</span>EventEmitter<span class="k">,</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>  inherits <span class="k">=</span> require<span class="k">(</span><span class="s">'util'</span><span class="k">).</span>inherits<span class="k">,</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>  binaryutils <span class="k">=</span> require<span class="k">(</span><span class="s">'../utils'</span><span class="k">),</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>  tls <span class="k">=</span> require<span class="k">(</span><span class="s">'tls'</span><span class="k">);</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code><span class="k">var</span> Connection <span class="k">=</span> exports<span class="k">.</span>Connection <span class="k">=</span> <span class="k">function</span><span class="k">(</span>id<span class="k">,</span> socketOptions<span class="k">)</span> <span class="k">{</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>  <span class="c">// Set up event emitter</span></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse perfectly aligned message from socket<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>  EventEmitter<span class="k">.</span>call<span class="k">(</span><span class="k">this</span><span class="k">);</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>  <span class="c">// Store all socket options</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>  <span class="k">this</span><span class="k">.</span>socketOptions <span class="k">=</span> socketOptions <span class="k">?</span> socketOptions <span class="k">:</span> <span class="k">{</span>host<span class="k">:</span><span class="s">'localhost'</span><span class="k">,</span> port<span class="k">:</span><span class="s">27017</span><span class="k">,</span> domainSocket<span class="k">:</span><span class="k">false</span><span class="k">}</span><span class="k">;</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>  <span class="c">// Set keep alive default if not overriden</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>  <span class="k">if</span><span class="k">(!</span><span class="k">this</span><span class="k">.</span>socketOptions<span class="k">.</span>keepAlive<span class="k">)</span> <span class="k">this</span><span class="k">.</span>socketOptions<span class="k">.</span>keepAlive <span class="k">=</span> <span class="s">100</span><span class="k">;</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>  <span class="c">// Id for the connection</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>  <span class="k">this</span><span class="k">.</span>id <span class="k">=</span> id<span class="k">;</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>  <span class="c">// State of the connection</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>  <span class="k">this</span><span class="k">.</span>connected <span class="k">=</span> <span class="k">false</span><span class="k">;</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>  <span class="c">// Set if this is a domain socket</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>  <span class="k">this</span><span class="k">.</span>domainSocket <span class="k">=</span> <span class="k">this</span><span class="k">.</span>socketOptions<span class="k">.</span>domainSocket<span class="k">;</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>  <span class="c">//</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>  <span class="c">// Connection parsing state</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>  <span class="c">//</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>  <span class="k">this</span><span class="k">.</span>maxBsonSize <span class="k">=</span> socketOptions<span class="k">.</span>maxBsonSize <span class="k">?</span> socketOptions<span class="k">.</span>maxBsonSize <span class="k">:</span> Connection<span class="k">.</span>DEFAULT_MAX_BSON_SIZE<span class="k">;</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>  <span class="c">// Contains the current message bytes</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>  <span class="k">this</span><span class="k">.</span>buffer <span class="k">=</span> <span class="k">null</span><span class="k">;</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>  <span class="c">// Contains the current message size</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>  <span class="k">this</span><span class="k">.</span>sizeOfMessage <span class="k">=</span> <span class="s">0</span><span class="k">;</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>  <span class="c">// Contains the readIndex for the messaage</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>  <span class="k">this</span><span class="k">.</span>bytesRead <span class="k">=</span> <span class="s">0</span><span class="k">;</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>  <span class="c">// Contains spill over bytes from additional messages</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>  <span class="k">this</span><span class="k">.</span>stubBuffer <span class="k">=</span> <span class="s">0</span><span class="k">;</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>  <span class="c">// Just keeps list of events we allow</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>  <span class="k">this</span><span class="k">.</span>eventHandlers <span class="k">=</span> <span class="k">{</span>error<span class="k">:[],</span> parseError<span class="k">:[],</span> poolReady<span class="k">:[],</span> message<span class="k">:[],</span> close<span class="k">:[],</span> timeout<span class="k">:[],</span> end<span class="k">:[]</span><span class="k">}</span><span class="k">;</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>  <span class="c">// Just keeps list of events we allow</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>  resetHandlers<span class="k">(</span><span class="k">this</span><span class="k">,</span> <span class="k">false</span><span class="k">);</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code><span class="k">}</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code><span class="c">// Set max bson size</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>Connection<span class="k">.</span>DEFAULT_MAX_BSON_SIZE <span class="k">=</span> <span class="s">1024</span> <span class="k">*</span> <span class="s">1024</span> <span class="k">*</span> <span class="s">4</span><span class="k">;</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse perfectly aligned message from socket<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code><span class="c">// Inherit event emitter so we can emit stuff wohoo</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>inherits<span class="k">(</span>Connection<span class="k">,</span> EventEmitter<span class="k">);</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse perfectly aligned message from socket<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>Connection<span class="k">.</span>prototype<span class="k">.</span>start <span class="k">=</span> <span class="k">function</span><span class="k">()</span> <span class="k">{</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>  <span class="c">// If we have a normal connection</span></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse perfectly aligned message from socket<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>  <span class="k">if</span><span class="k">(</span><span class="k">this</span><span class="k">.</span>socketOptions<span class="k">.</span>ssl<span class="k">)</span> <span class="k">{</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="c">// Create a new stream</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="k">this</span><span class="k">.</span>connection <span class="k">=</span> <span class="k">new</span> net<span class="k">.</span>Socket<span class="k">();</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="c">// Set timeout allowing backward compatibility to timeout if no connectTimeoutMS is set</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="k">this</span><span class="k">.</span>connection<span class="k">.</span>setTimeout<span class="k">(</span><span class="k">this</span><span class="k">.</span>socketOptions<span class="k">.</span>connectTimeoutMS <span class="k">!=</span> <span class="k">null</span> <span class="k">?</span> <span class="k">this</span><span class="k">.</span>socketOptions<span class="k">.</span>connectTimeoutMS <span class="k">:</span> <span class="k">this</span><span class="k">.</span>socketOptions<span class="k">.</span>timeout<span class="k">);</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="c">// Work around for 0.4.X</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="k">if</span><span class="k">(</span>process<span class="k">.</span>version<span class="k">.</span>indexOf<span class="k">(</span><span class="s">"v0.4"</span><span class="k">)</span> <span class="k">==</span> <span class="k">-</span><span class="s">1</span><span class="k">)</span> <span class="k">this</span><span class="k">.</span>connection<span class="k">.</span>setNoDelay<span class="k">(</span><span class="k">this</span><span class="k">.</span>socketOptions<span class="k">.</span>noDelay<span class="k">);</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="c">// Set keep alive if defined</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="k">if</span><span class="k">(</span>process<span class="k">.</span>version<span class="k">.</span>indexOf<span class="k">(</span><span class="s">"v0.4"</span><span class="k">)</span> <span class="k">==</span> <span class="k">-</span><span class="s">1</span><span class="k">)</span> <span class="k">{</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>      <span class="k">if</span><span class="k">(</span><span class="k">this</span><span class="k">.</span>socketOptions<span class="k">.</span>keepAlive <span class="k">&gt;</span> <span class="s">0</span><span class="k">)</span> <span class="k">{</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>        <span class="k">this</span><span class="k">.</span>connection<span class="k">.</span>setKeepAlive<span class="k">(</span><span class="k">true</span><span class="k">,</span> <span class="k">this</span><span class="k">.</span>socketOptions<span class="k">.</span>keepAlive<span class="k">);</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>      <span class="k">}</span> <span class="k">else</span> <span class="k">{</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>        <span class="k">this</span><span class="k">.</span>connection<span class="k">.</span>setKeepAlive<span class="k">(</span><span class="k">false</span><span class="k">);</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>      <span class="k">}</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="k">}</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="c">// Set up pair for tls with server, accept self-signed certificates as well</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="k">var</span> pair <span class="k">=</span> <span class="k">this</span><span class="k">.</span>pair <span class="k">=</span> tls<span class="k">.</span>createSecurePair<span class="k">(</span><span class="k">false</span><span class="k">);</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="c">// Set up encrypted streams</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="k">this</span><span class="k">.</span>pair<span class="k">.</span>encrypted<span class="k">.</span>pipe<span class="k">(</span><span class="k">this</span><span class="k">.</span>connection<span class="k">);</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="k">this</span><span class="k">.</span>connection<span class="k">.</span>pipe<span class="k">(</span><span class="k">this</span><span class="k">.</span>pair<span class="k">.</span>encrypted<span class="k">);</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="c">// Setup clearText stream</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="k">this</span><span class="k">.</span>writeSteam <span class="k">=</span> <span class="k">this</span><span class="k">.</span>pair<span class="k">.</span>cleartext<span class="k">;</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="c">// Add all handlers to the socket to manage it</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="k">this</span><span class="k">.</span>pair<span class="k">.</span>on<span class="k">(</span><span class="s">"secure"</span><span class="k">,</span> connectHandler<span class="k">(</span><span class="k">this</span><span class="k">));</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="k">this</span><span class="k">.</span>pair<span class="k">.</span>cleartext<span class="k">.</span>on<span class="k">(</span><span class="s">"data"</span><span class="k">,</span> createDataHandler<span class="k">(</span><span class="k">this</span><span class="k">));</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="c">// Add handlers</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="k">this</span><span class="k">.</span>connection<span class="k">.</span>on<span class="k">(</span><span class="s">"error"</span><span class="k">,</span> errorHandler<span class="k">(</span><span class="k">this</span><span class="k">));</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="c">// this.connection.on("connect", connectHandler(this));</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="k">this</span><span class="k">.</span>connection<span class="k">.</span>on<span class="k">(</span><span class="s">"end"</span><span class="k">,</span> endHandler<span class="k">(</span><span class="k">this</span><span class="k">));</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="k">this</span><span class="k">.</span>connection<span class="k">.</span>on<span class="k">(</span><span class="s">"timeout"</span><span class="k">,</span> timeoutHandler<span class="k">(</span><span class="k">this</span><span class="k">));</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="k">this</span><span class="k">.</span>connection<span class="k">.</span>on<span class="k">(</span><span class="s">"drain"</span><span class="k">,</span> drainHandler<span class="k">(</span><span class="k">this</span><span class="k">));</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="k">this</span><span class="k">.</span>writeSteam<span class="k">.</span>on<span class="k">(</span><span class="s">"close"</span><span class="k">,</span> closeHandler<span class="k">(</span><span class="k">this</span><span class="k">));</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="c">// Start socket</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="k">this</span><span class="k">.</span>connection<span class="k">.</span>connect<span class="k">(</span><span class="k">this</span><span class="k">.</span>socketOptions<span class="k">.</span>port<span class="k">,</span> <span class="k">this</span><span class="k">.</span>socketOptions<span class="k">.</span>host<span class="k">);</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>  <span class="k">}</span> <span class="k">else</span> <span class="k">{</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="c">// Create new connection instance</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="k">if</span><span class="k">(!</span><span class="k">this</span><span class="k">.</span>domainSocket<span class="k">)</span> <span class="k">{</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>      <span class="k">this</span><span class="k">.</span>connection <span class="k">=</span> net<span class="k">.</span>createConnection<span class="k">(</span><span class="k">this</span><span class="k">.</span>socketOptions<span class="k">.</span>port<span class="k">,</span> <span class="k">this</span><span class="k">.</span>socketOptions<span class="k">.</span>host<span class="k">);</span>      </code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="k">}</span> <span class="k">else</span> <span class="k">{</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>      <span class="k">this</span><span class="k">.</span>connection <span class="k">=</span> net<span class="k">.</span>createConnection<span class="k">(</span><span class="k">this</span><span class="k">.</span>socketOptions<span class="k">.</span>host<span class="k">);</span>            </code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="k">}</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="c">// Set options on the socket</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="k">this</span><span class="k">.</span>connection<span class="k">.</span>setTimeout<span class="k">(</span><span class="k">this</span><span class="k">.</span>socketOptions<span class="k">.</span>connectTimeoutMS <span class="k">!=</span> <span class="k">null</span> <span class="k">?</span> <span class="k">this</span><span class="k">.</span>socketOptions<span class="k">.</span>connectTimeoutMS <span class="k">:</span> <span class="k">this</span><span class="k">.</span>socketOptions<span class="k">.</span>timeout<span class="k">);</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="c">// Work around for 0.4.X</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="k">if</span><span class="k">(</span>process<span class="k">.</span>version<span class="k">.</span>indexOf<span class="k">(</span><span class="s">"v0.4"</span><span class="k">)</span> <span class="k">==</span> <span class="k">-</span><span class="s">1</span><span class="k">)</span> <span class="k">this</span><span class="k">.</span>connection<span class="k">.</span>setNoDelay<span class="k">(</span><span class="k">this</span><span class="k">.</span>socketOptions<span class="k">.</span>noDelay<span class="k">);</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="c">// Set keep alive if defined</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="k">if</span><span class="k">(</span>process<span class="k">.</span>version<span class="k">.</span>indexOf<span class="k">(</span><span class="s">"v0.4"</span><span class="k">)</span> <span class="k">==</span> <span class="k">-</span><span class="s">1</span><span class="k">)</span> <span class="k">{</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>      <span class="k">if</span><span class="k">(</span><span class="k">this</span><span class="k">.</span>socketOptions<span class="k">.</span>keepAlive <span class="k">&gt;</span> <span class="s">0</span><span class="k">)</span> <span class="k">{</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>        <span class="k">this</span><span class="k">.</span>connection<span class="k">.</span>setKeepAlive<span class="k">(</span><span class="k">true</span><span class="k">,</span> <span class="k">this</span><span class="k">.</span>socketOptions<span class="k">.</span>keepAlive<span class="k">);</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>      <span class="k">}</span> <span class="k">else</span> <span class="k">{</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>        <span class="k">this</span><span class="k">.</span>connection<span class="k">.</span>setKeepAlive<span class="k">(</span><span class="k">false</span><span class="k">);</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>      <span class="k">}</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="k">}</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="c">// Set up write stream</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="k">this</span><span class="k">.</span>writeSteam <span class="k">=</span> <span class="k">this</span><span class="k">.</span>connection<span class="k">;</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="c">// Add handlers</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="k">this</span><span class="k">.</span>connection<span class="k">.</span>on<span class="k">(</span><span class="s">"error"</span><span class="k">,</span> errorHandler<span class="k">(</span><span class="k">this</span><span class="k">));</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="c">// Add all handlers to the socket to manage it</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="k">this</span><span class="k">.</span>connection<span class="k">.</span>on<span class="k">(</span><span class="s">"connect"</span><span class="k">,</span> connectHandler<span class="k">(</span><span class="k">this</span><span class="k">));</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="c">// this.connection.on("end", endHandler(this));</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="k">this</span><span class="k">.</span>connection<span class="k">.</span>on<span class="k">(</span><span class="s">"data"</span><span class="k">,</span> createDataHandler<span class="k">(</span><span class="k">this</span><span class="k">));</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="k">this</span><span class="k">.</span>connection<span class="k">.</span>on<span class="k">(</span><span class="s">"timeout"</span><span class="k">,</span> timeoutHandler<span class="k">(</span><span class="k">this</span><span class="k">));</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="k">this</span><span class="k">.</span>connection<span class="k">.</span>on<span class="k">(</span><span class="s">"drain"</span><span class="k">,</span> drainHandler<span class="k">(</span><span class="k">this</span><span class="k">));</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="k">this</span><span class="k">.</span>connection<span class="k">.</span>on<span class="k">(</span><span class="s">"close"</span><span class="k">,</span> closeHandler<span class="k">(</span><span class="k">this</span><span class="k">));</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>  <span class="k">}</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code><span class="k">}</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code><span class="c">// Check if the sockets are live</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>Connection<span class="k">.</span>prototype<span class="k">.</span>isConnected <span class="k">=</span> <span class="k">function</span><span class="k">()</span> <span class="k">{</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>  <span class="k">return</span> <span class="k">this</span><span class="k">.</span>connected <span class="k">&amp;&amp;</span> <span class="k">!</span><span class="k">this</span><span class="k">.</span>connection<span class="k">.</span>destroyed <span class="k">&amp;&amp;</span> <span class="k">this</span><span class="k">.</span>connection<span class="k">.</span>writable <span class="k">&amp;&amp;</span> <span class="k">this</span><span class="k">.</span>connection<span class="k">.</span>readable<span class="k">;</span></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse perfectly aligned message from socket<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code><span class="k">}</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code><span class="c">// Write the data out to the socket</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>Connection<span class="k">.</span>prototype<span class="k">.</span>write <span class="k">=</span> <span class="k">function</span><span class="k">(</span>command<span class="k">,</span> callback<span class="k">)</span> <span class="k">{</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>  <span class="k">try</span> <span class="k">{</span></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse perfectly aligned message from socket<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="c">// If we have a list off commands to be executed on the same socket</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="k">if</span><span class="k">(</span>Array<span class="k">.</span>isArray<span class="k">(</span>command<span class="k">))</span> <span class="k">{</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>      <span class="k">for</span><span class="k">(</span><span class="k">var</span> i <span class="k">=</span> <span class="s">0</span><span class="k">;</span> i <span class="k">&lt;</span> command<span class="k">.</span>length<span class="k">;</span> i<span class="k">++)</span> <span class="k">{</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>        <span class="k">var</span> binaryCommand <span class="k">=</span> command<span class="k">[</span>i<span class="k">].</span>toBinary<span class="k">()</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>        <span class="k">if</span><span class="k">(!</span><span class="k">this</span><span class="k">.</span>socketOptions<span class="k">[</span><span class="s">'disableDriverBSONSizeCheck'</span><span class="k">]</span> <span class="k">&amp;&amp;</span> binaryCommand<span class="k">.</span>length <span class="k">&gt;</span> <span class="k">this</span><span class="k">.</span>maxBsonSize<span class="k">)</span> </code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>          <span class="k">return</span> callback<span class="k">(</span><span class="k">new</span> Error<span class="k">(</span><span class="s">"Document exceeds maximal allowed bson size of "</span> <span class="k">+</span> <span class="k">this</span><span class="k">.</span>maxBsonSize <span class="k">+</span> <span class="s">" bytes"</span><span class="k">));</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>        <span class="k">if</span><span class="k">(</span><span class="k">this</span><span class="k">.</span>logger <span class="k">!=</span> <span class="k">null</span> <span class="k">&amp;&amp;</span> <span class="k">this</span><span class="k">.</span>logger<span class="k">.</span>doDebug<span class="k">)</span> </code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>          <span class="k">this</span><span class="k">.</span>logger<span class="k">.</span>debug<span class="k">(</span><span class="s">"writing command to mongodb"</span><span class="k">,</span> binaryCommand<span class="k">);</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>        </code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>        <span class="k">var</span> r <span class="k">=</span> <span class="k">this</span><span class="k">.</span>writeSteam<span class="k">.</span>write<span class="k">(</span>binaryCommand<span class="k">);</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>      <span class="k">}</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="k">}</span> <span class="k">else</span> <span class="k">{</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>      <span class="k">var</span> binaryCommand <span class="k">=</span> command<span class="k">.</span>toBinary<span class="k">()</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>      <span class="k">if</span><span class="k">(!</span><span class="k">this</span><span class="k">.</span>socketOptions<span class="k">[</span><span class="s">'disableDriverBSONSizeCheck'</span><span class="k">]</span> <span class="k">&amp;&amp;</span> binaryCommand<span class="k">.</span>length <span class="k">&gt;</span> <span class="k">this</span><span class="k">.</span>maxBsonSize<span class="k">)</span> </code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>        <span class="k">return</span> callback<span class="k">(</span><span class="k">new</span> Error<span class="k">(</span><span class="s">"Document exceeds maximal allowed bson size of "</span> <span class="k">+</span> <span class="k">this</span><span class="k">.</span>maxBsonSize <span class="k">+</span> <span class="s">" bytes"</span><span class="k">));</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>      </code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>      <span class="k">if</span><span class="k">(</span><span class="k">this</span><span class="k">.</span>logger <span class="k">!=</span> <span class="k">null</span> <span class="k">&amp;&amp;</span> <span class="k">this</span><span class="k">.</span>logger<span class="k">.</span>doDebug<span class="k">)</span> </code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>        <span class="k">this</span><span class="k">.</span>logger<span class="k">.</span>debug<span class="k">(</span><span class="s">"writing command to mongodb"</span><span class="k">,</span> binaryCommand<span class="k">);</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>      <span class="k">var</span> r <span class="k">=</span> <span class="k">this</span><span class="k">.</span>writeSteam<span class="k">.</span>write<span class="k">(</span>binaryCommand<span class="k">);</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="k">}</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>  <span class="k">}</span> <span class="k">catch</span> <span class="k">(</span>err<span class="k">)</span> <span class="k">{</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="k">if</span><span class="k">(</span><span class="k">typeof</span> callback <span class="k">===</span> <span class="s">'function'</span><span class="k">)</span> callback<span class="k">(</span>err<span class="k">);</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>  <span class="k">}</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code><span class="k">}</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code><span class="c">// Force the closure of the connection</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>Connection<span class="k">.</span>prototype<span class="k">.</span>close <span class="k">=</span> <span class="k">function</span><span class="k">()</span> <span class="k">{</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>  <span class="c">// clear out all the listeners</span></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse perfectly aligned message from socket<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>  resetHandlers<span class="k">(</span><span class="k">this</span><span class="k">,</span> <span class="k">true</span><span class="k">);</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>  <span class="c">// Add a dummy error listener to catch any weird last moment errors (and ignore them)</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>  <span class="k">this</span><span class="k">.</span>connection<span class="k">.</span>on<span class="k">(</span><span class="s">"error"</span><span class="k">,</span> <span class="k">function</span><span class="k">()</span> <span class="k">{}</span><span class="k">)</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>  <span class="c">// destroy connection</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>  <span class="k">this</span><span class="k">.</span>connection<span class="k">.</span>destroy<span class="k">();</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code><span class="k">}</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code><span class="c">// Reset all handlers</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code><span class="k">var</span> resetHandlers <span class="k">=</span> <span class="k">function</span><span class="k">(</span>self<span class="k">,</span> clearListeners<span class="k">)</span> <span class="k">{</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>  self<span class="k">.</span>eventHandlers <span class="k">=</span> <span class="k">{</span>error<span class="k">:[],</span> connect<span class="k">:[],</span> close<span class="k">:[],</span> end<span class="k">:[],</span> timeout<span class="k">:[],</span> parseError<span class="k">:[],</span> message<span class="k">:[]</span><span class="k">}</span><span class="k">;</span></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse perfectly aligned message from socket<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>  <span class="c">// If we want to clear all the listeners</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>  <span class="k">if</span><span class="k">(</span>clearListeners <span class="k">&amp;&amp;</span> self<span class="k">.</span>connection <span class="k">!=</span> <span class="k">null</span><span class="k">)</span> <span class="k">{</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="k">var</span> keys <span class="k">=</span> Object<span class="k">.</span>keys<span class="k">(</span>self<span class="k">.</span>eventHandlers<span class="k">);</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="c">// Remove all listeners</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="k">for</span><span class="k">(</span><span class="k">var</span> i <span class="k">=</span> <span class="s">0</span><span class="k">;</span> i <span class="k">&lt;</span> keys<span class="k">.</span>length<span class="k">;</span> i<span class="k">++)</span> <span class="k">{</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>      self<span class="k">.</span>connection<span class="k">.</span>removeAllListeners<span class="k">(</span>keys<span class="k">[</span>i<span class="k">]);</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="k">}</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>  <span class="k">}</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code><span class="k">}</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code><span class="c">//</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code><span class="c">// Handlers</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code><span class="c">//</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code><span class="c">// Connect handler</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code><span class="k">var</span> connectHandler <span class="k">=</span> <span class="k">function</span><span class="k">(</span>self<span class="k">)</span> <span class="k">{</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>  <span class="k">return</span> <span class="k">function</span><span class="k">()</span> <span class="k">{</span></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse perfectly aligned message from socket<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="c">// Set connected</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    self<span class="k">.</span>connected <span class="k">=</span> <span class="k">true</span><span class="k">;</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="c">// Now that we are connected set the socket timeout</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    self<span class="k">.</span>connection<span class="k">.</span>setTimeout<span class="k">(</span>self<span class="k">.</span>socketOptions<span class="k">.</span>socketTimeoutMS <span class="k">!=</span> <span class="k">null</span> <span class="k">?</span> self<span class="k">.</span>socketOptions<span class="k">.</span>socketTimeoutMS <span class="k">:</span> self<span class="k">.</span>socketOptions<span class="k">.</span>timeout<span class="k">);</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="c">// Emit the connect event with no error</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    self<span class="k">.</span>emit<span class="k">(</span><span class="s">"connect"</span><span class="k">,</span> <span class="k">null</span><span class="k">,</span> self<span class="k">);</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>  <span class="k">}</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code><span class="k">}</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code><span class="k">var</span> createDataHandler <span class="k">=</span> exports<span class="k">.</span>Connection<span class="k">.</span>createDataHandler <span class="k">=</span> <span class="k">function</span><span class="k">(</span>self<span class="k">)</span> <span class="k">{</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>  <span class="c">// We need to handle the parsing of the data</span></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse perfectly aligned message from socket<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>  <span class="c">// and emit the messages when there is a complete one</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>  <span class="k">return</span> <span class="k">function</span><span class="k">(</span>data<span class="k">)</span> <span class="k">{</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="c">// Parse until we are done with the data</span></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse perfectly aligned message from socket<br/><br/>test/connection/message_parser_test.js :: Should correctly parse perfectly aligned double message from socket<br/><br/>test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket<br/><br/>test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and partial third one<br/><br/>test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and smaller than 4 bytes additional one<br/><br/>test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and smaller than 4 bytes additional one then rest of the message<br/><br/>test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and smaller than 4 bytes additional one then partial message<br/><br/>test/connection/message_parser_test.js :: Corrupt the message baby<br/><br/>test/connection/message_parser_test.js :: Corrupt the message baby but catch the log error<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="k">while</span><span class="k">(</span>data<span class="k">.</span>length <span class="k">&gt;</span> <span class="s">0</span><span class="k">)</span> <span class="k">{</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>      <span class="c">// If we still have bytes to read on the current message</span></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse perfectly aligned message from socket<br/><br/>test/connection/message_parser_test.js :: Should correctly parse perfectly aligned double message from socket<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>      <span class="k">if</span><span class="k">(</span>self<span class="k">.</span>bytesRead <span class="k">&gt;</span> <span class="s">0</span> <span class="k">&amp;&amp;</span> self<span class="k">.</span>sizeOfMessage <span class="k">&gt;</span> <span class="s">0</span><span class="k">)</span> <span class="k">{</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>        <span class="c">// Calculate the amount of remaining bytes</span></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse perfectly aligned message from socket<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>        <span class="k">var</span> remainingBytesToRead <span class="k">=</span> self<span class="k">.</span>sizeOfMessage <span class="k">-</span> self<span class="k">.</span>bytesRead<span class="k">;</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>        <span class="c">// Check if the current chunk contains the rest of the message</span></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket<br/><br/>test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and partial third one<br/><br/>test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and smaller than 4 bytes additional one<br/><br/>test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and smaller than 4 bytes additional one then rest of the message<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>        <span class="k">if</span><span class="k">(</span>remainingBytesToRead <span class="k">&gt;</span> data<span class="k">.</span>length<span class="k">)</span> <span class="k">{</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>          <span class="c">// Copy the new data into the exiting buffer (should have been allocated when we know the message size)</span></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket<br/><br/>test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and partial third one<br/><br/>test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and smaller than 4 bytes additional one<br/><br/>test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and smaller than 4 bytes additional one then rest of the message<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>          data<span class="k">.</span>copy<span class="k">(</span>self<span class="k">.</span>buffer<span class="k">,</span> self<span class="k">.</span>bytesRead<span class="k">);</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>          <span class="c">// Adjust the number of bytes read so it point to the correct index in the buffer</span></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and smaller than 4 bytes additional one then partial message<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>          self<span class="k">.</span>bytesRead <span class="k">=</span> self<span class="k">.</span>bytesRead <span class="k">+</span> data<span class="k">.</span>length<span class="k">;</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and smaller than 4 bytes additional one then partial message<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>          <span class="c">// Reset state of buffer</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>          data <span class="k">=</span> <span class="k">new</span> Buffer<span class="k">(</span><span class="s">0</span><span class="k">);</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>        <span class="k">}</span> <span class="k">else</span> <span class="k">{</span></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and smaller than 4 bytes additional one then partial message<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>          <span class="c">// Copy the missing part of the data into our current buffer</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>          data<span class="k">.</span>copy<span class="k">(</span>self<span class="k">.</span>buffer<span class="k">,</span> self<span class="k">.</span>bytesRead<span class="k">,</span> <span class="s">0</span><span class="k">,</span> remainingBytesToRead<span class="k">);</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>          <span class="c">// Slice the overflow into a new buffer that we will then re-parse</span></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket<br/><br/>test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and partial third one<br/><br/>test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and smaller than 4 bytes additional one<br/><br/>test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and smaller than 4 bytes additional one then rest of the message<br/><br/>test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and smaller than 4 bytes additional one then partial message<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>          data <span class="k">=</span> data<span class="k">.</span>slice<span class="k">(</span>remainingBytesToRead<span class="k">);</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket<br/><br/>test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and partial third one<br/><br/>test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and smaller than 4 bytes additional one<br/><br/>test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and smaller than 4 bytes additional one then rest of the message<br/><br/>test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and smaller than 4 bytes additional one then partial message<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>          <span class="c">// Emit current complete message</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>          <span class="k">try</span> <span class="k">{</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>            <span class="k">var</span> emitBuffer <span class="k">=</span> self<span class="k">.</span>buffer<span class="k">;</span></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket<br/><br/>test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and partial third one<br/><br/>test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and smaller than 4 bytes additional one<br/><br/>test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and smaller than 4 bytes additional one then rest of the message<br/><br/>test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and smaller than 4 bytes additional one then partial message<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>            <span class="c">// Reset state of buffer</span></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket<br/><br/>test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and partial third one<br/><br/>test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and smaller than 4 bytes additional one<br/><br/>test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and smaller than 4 bytes additional one then rest of the message<br/><br/>test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and smaller than 4 bytes additional one then partial message<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>            self<span class="k">.</span>buffer <span class="k">=</span> <span class="k">null</span><span class="k">;</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>            self<span class="k">.</span>sizeOfMessage <span class="k">=</span> <span class="s">0</span><span class="k">;</span></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket<br/><br/>test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and partial third one<br/><br/>test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and smaller than 4 bytes additional one<br/><br/>test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and smaller than 4 bytes additional one then rest of the message<br/><br/>test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and smaller than 4 bytes additional one then partial message<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>            self<span class="k">.</span>bytesRead <span class="k">=</span> <span class="s">0</span><span class="k">;</span></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket<br/><br/>test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and partial third one<br/><br/>test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and smaller than 4 bytes additional one<br/><br/>test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and smaller than 4 bytes additional one then rest of the message<br/><br/>test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and smaller than 4 bytes additional one then partial message<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>            self<span class="k">.</span>stubBuffer <span class="k">=</span> <span class="k">null</span><span class="k">;</span></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket<br/><br/>test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and partial third one<br/><br/>test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and smaller than 4 bytes additional one<br/><br/>test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and smaller than 4 bytes additional one then rest of the message<br/><br/>test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and smaller than 4 bytes additional one then partial message<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>            <span class="c">// Emit the buffer</span></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket<br/><br/>test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and partial third one<br/><br/>test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and smaller than 4 bytes additional one<br/><br/>test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and smaller than 4 bytes additional one then rest of the message<br/><br/>test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and smaller than 4 bytes additional one then partial message<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>            self<span class="k">.</span>emit<span class="k">(</span><span class="s">"message"</span><span class="k">,</span> emitBuffer<span class="k">,</span> self<span class="k">);</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>          <span class="k">}</span> <span class="k">catch</span><span class="k">(</span>err<span class="k">)</span> <span class="k">{</span></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket<br/><br/>test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and partial third one<br/><br/>test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and smaller than 4 bytes additional one<br/><br/>test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and smaller than 4 bytes additional one then rest of the message<br/><br/>test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and smaller than 4 bytes additional one then partial message<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>            <span class="k">var</span> errorObject <span class="k">=</span> <span class="k">{</span>err<span class="k">:</span><span class="s">"socketHandler"</span><span class="k">,</span> trace<span class="k">:</span>err<span class="k">,</span> bin<span class="k">:</span>buffer<span class="k">,</span> parseState<span class="k">:</span><span class="k">{</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>              sizeOfMessage<span class="k">:</span>self<span class="k">.</span>sizeOfMessage<span class="k">,</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>              bytesRead<span class="k">:</span>self<span class="k">.</span>bytesRead<span class="k">,</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>              stubBuffer<span class="k">:</span>self<span class="k">.</span>stubBuffer<span class="k">}}</span><span class="k">;</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>            <span class="k">if</span><span class="k">(</span>self<span class="k">.</span>logger <span class="k">!=</span> <span class="k">null</span> <span class="k">&amp;&amp;</span> self<span class="k">.</span>logger<span class="k">.</span>doError<span class="k">)</span> self<span class="k">.</span>logger<span class="k">.</span>error<span class="k">(</span><span class="s">"parseError"</span><span class="k">,</span> errorObject<span class="k">);</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>            <span class="c">// We got a parse Error fire it off then keep going</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>            self<span class="k">.</span>emit<span class="k">(</span><span class="s">"parseError"</span><span class="k">,</span> errorObject<span class="k">,</span> self<span class="k">);</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>          <span class="k">}</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>        <span class="k">}</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>      <span class="k">}</span> <span class="k">else</span> <span class="k">{</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>        <span class="c">// Stub buffer is kept in case we don't get enough bytes to determine the</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>        <span class="c">// size of the message (&lt; 4 bytes)</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>        <span class="k">if</span><span class="k">(</span>self<span class="k">.</span>stubBuffer <span class="k">!=</span> <span class="k">null</span> <span class="k">&amp;&amp;</span> self<span class="k">.</span>stubBuffer<span class="k">.</span>length <span class="k">&gt;</span> <span class="s">0</span><span class="k">)</span> <span class="k">{</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse perfectly aligned message from socket<br/><br/>test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>          <span class="c">// If we have enough bytes to determine the message size let's do it</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>          <span class="k">if</span><span class="k">(</span>self<span class="k">.</span>stubBuffer<span class="k">.</span>length <span class="k">+</span> data<span class="k">.</span>length <span class="k">&gt;</span> <span class="s">4</span><span class="k">)</span> <span class="k">{</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>            <span class="c">// Prepad the data</span></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and smaller than 4 bytes additional one then rest of the message<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>            <span class="k">var</span> newData <span class="k">=</span> <span class="k">new</span> Buffer<span class="k">(</span>self<span class="k">.</span>stubBuffer<span class="k">.</span>length <span class="k">+</span> data<span class="k">.</span>length<span class="k">);</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>            self<span class="k">.</span>stubBuffer<span class="k">.</span>copy<span class="k">(</span>newData<span class="k">,</span> <span class="s">0</span><span class="k">);</span></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and smaller than 4 bytes additional one then rest of the message<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>            data<span class="k">.</span>copy<span class="k">(</span>newData<span class="k">,</span> self<span class="k">.</span>stubBuffer<span class="k">.</span>length<span class="k">);</span></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and smaller than 4 bytes additional one then rest of the message<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>            <span class="c">// Reassign for parsing</span></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and smaller than 4 bytes additional one then rest of the message<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>            data <span class="k">=</span> newData<span class="k">;</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and smaller than 4 bytes additional one then rest of the message<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>            <span class="c">// Reset state of buffer</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>            self<span class="k">.</span>buffer <span class="k">=</span> <span class="k">null</span><span class="k">;</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>            self<span class="k">.</span>sizeOfMessage <span class="k">=</span> <span class="s">0</span><span class="k">;</span></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and smaller than 4 bytes additional one then rest of the message<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>            self<span class="k">.</span>bytesRead <span class="k">=</span> <span class="s">0</span><span class="k">;</span></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and smaller than 4 bytes additional one then rest of the message<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>            self<span class="k">.</span>stubBuffer <span class="k">=</span> <span class="k">null</span><span class="k">;</span></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and smaller than 4 bytes additional one then rest of the message<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and smaller than 4 bytes additional one then rest of the message<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>          <span class="k">}</span> <span class="k">else</span> <span class="k">{</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>            <span class="c">// Add the the bytes to the stub buffer</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>            <span class="k">var</span> newStubBuffer <span class="k">=</span> <span class="k">new</span> Buffer<span class="k">(</span>self<span class="k">.</span>stubBuffer<span class="k">.</span>length <span class="k">+</span> data<span class="k">.</span>length<span class="k">);</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>            <span class="c">// Copy existing stub buffer</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>            self<span class="k">.</span>stubBuffer<span class="k">.</span>copy<span class="k">(</span>newStubBuffer<span class="k">,</span> <span class="s">0</span><span class="k">);</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>            <span class="c">// Copy missing part of the data</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>            data<span class="k">.</span>copy<span class="k">(</span>newStubBuffer<span class="k">,</span> self<span class="k">.</span>stubBuffer<span class="k">.</span>length<span class="k">);</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>            <span class="c">// Exit parsing loop</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>            data <span class="k">=</span> <span class="k">new</span> Buffer<span class="k">(</span><span class="s">0</span><span class="k">);</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>          <span class="k">}</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>        <span class="k">}</span> <span class="k">else</span> <span class="k">{</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>          <span class="k">if</span><span class="k">(</span>data<span class="k">.</span>length <span class="k">&gt;</span> <span class="s">4</span><span class="k">)</span> <span class="k">{</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>            <span class="c">// Retrieve the message size</span></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse perfectly aligned message from socket<br/><br/>test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>            <span class="k">var</span> sizeOfMessage <span class="k">=</span> binaryutils<span class="k">.</span>decodeUInt32<span class="k">(</span>data<span class="k">,</span> <span class="s">0</span><span class="k">);</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>            <span class="c">// If we have a negative sizeOfMessage emit error and return</span></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse perfectly aligned message from socket<br/><br/>test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket<br/><br/>test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and smaller than 4 bytes additional one<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>            <span class="k">if</span><span class="k">(</span>sizeOfMessage <span class="k">&lt;</span> <span class="s">0</span> <span class="k">||</span> sizeOfMessage <span class="k">&gt;</span> self<span class="k">.</span>maxBsonSize<span class="k">)</span> <span class="k">{</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>              <span class="k">var</span> errorObject <span class="k">=</span> <span class="k">{</span>err<span class="k">:</span><span class="s">"socketHandler"</span><span class="k">,</span> trace<span class="k">:</span><span class="s">''</span><span class="k">,</span> bin<span class="k">:</span>self<span class="k">.</span>buffer<span class="k">,</span> parseState<span class="k">:</span><span class="k">{</span></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse perfectly aligned message from socket<br/><br/>test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket<br/><br/>test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and smaller than 4 bytes additional one<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>                sizeOfMessage<span class="k">:</span> sizeOfMessage<span class="k">,</span></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Corrupt the message baby but catch the log error<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>                bytesRead<span class="k">:</span> self<span class="k">.</span>bytesRead<span class="k">,</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>                stubBuffer<span class="k">:</span> self<span class="k">.</span>stubBuffer<span class="k">}}</span><span class="k">;</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>              <span class="k">if</span><span class="k">(</span>self<span class="k">.</span>logger <span class="k">!=</span> <span class="k">null</span> <span class="k">&amp;&amp;</span> self<span class="k">.</span>logger<span class="k">.</span>doError<span class="k">)</span> self<span class="k">.</span>logger<span class="k">.</span>error<span class="k">(</span><span class="s">"parseError"</span><span class="k">,</span> errorObject<span class="k">);</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>              <span class="c">// We got a parse Error fire it off then keep going</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>              self<span class="k">.</span>emit<span class="k">(</span><span class="s">"parseError"</span><span class="k">,</span> errorObject<span class="k">,</span> self<span class="k">);</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>              <span class="k">return</span><span class="k">;</span></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Corrupt the message baby but catch the log error<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>            <span class="k">}</span></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Corrupt the message baby but catch the log error<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>            <span class="c">// Ensure that the size of message is larger than 0 and less than the max allowed</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>            <span class="k">if</span><span class="k">(</span>sizeOfMessage <span class="k">&gt;</span> <span class="s">4</span> <span class="k">&amp;&amp;</span> sizeOfMessage <span class="k">&lt;</span> self<span class="k">.</span>maxBsonSize <span class="k">&amp;&amp;</span> sizeOfMessage <span class="k">&gt;</span> data<span class="k">.</span>length<span class="k">)</span> <span class="k">{</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>              self<span class="k">.</span>buffer <span class="k">=</span> <span class="k">new</span> Buffer<span class="k">(</span>sizeOfMessage<span class="k">);</span></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse perfectly aligned message from socket<br/><br/>test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket<br/><br/>test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and smaller than 4 bytes additional one<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>              <span class="c">// Copy all the data into the buffer</span></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket<br/><br/>test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and smaller than 4 bytes additional one<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>              data<span class="k">.</span>copy<span class="k">(</span>self<span class="k">.</span>buffer<span class="k">,</span> <span class="s">0</span><span class="k">);</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>              <span class="c">// Update bytes read</span></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket<br/><br/>test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and smaller than 4 bytes additional one<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>              self<span class="k">.</span>bytesRead <span class="k">=</span> data<span class="k">.</span>length<span class="k">;</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>              <span class="c">// Update sizeOfMessage</span></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket<br/><br/>test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and smaller than 4 bytes additional one<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>              self<span class="k">.</span>sizeOfMessage <span class="k">=</span> sizeOfMessage<span class="k">;</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>              <span class="c">// Ensure stub buffer is null</span></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket<br/><br/>test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and smaller than 4 bytes additional one<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>              self<span class="k">.</span>stubBuffer <span class="k">=</span> <span class="k">null</span><span class="k">;</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>              <span class="c">// Exit parsing loop</span></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket<br/><br/>test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and smaller than 4 bytes additional one<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>              data <span class="k">=</span> <span class="k">new</span> Buffer<span class="k">(</span><span class="s">0</span><span class="k">);</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket<br/><br/>test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and smaller than 4 bytes additional one<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>            <span class="k">}</span> <span class="k">else</span> <span class="k">if</span><span class="k">(</span>sizeOfMessage <span class="k">&gt;</span> <span class="s">4</span> <span class="k">&amp;&amp;</span> sizeOfMessage <span class="k">&lt;</span> self<span class="k">.</span>maxBsonSize <span class="k">&amp;&amp;</span> sizeOfMessage <span class="k">==</span> data<span class="k">.</span>length<span class="k">)</span> <span class="k">{</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>              <span class="k">try</span> <span class="k">{</span></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse perfectly aligned message from socket<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>                <span class="k">var</span> emitBuffer <span class="k">=</span> data<span class="k">;</span></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse perfectly aligned message from socket<br/><br/>test/connection/message_parser_test.js :: Should correctly parse perfectly aligned double message from socket<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>                <span class="c">// Reset state of buffer</span></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse perfectly aligned message from socket<br/><br/>test/connection/message_parser_test.js :: Should correctly parse perfectly aligned double message from socket<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>                self<span class="k">.</span>buffer <span class="k">=</span> <span class="k">null</span><span class="k">;</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>                self<span class="k">.</span>sizeOfMessage <span class="k">=</span> <span class="s">0</span><span class="k">;</span></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse perfectly aligned message from socket<br/><br/>test/connection/message_parser_test.js :: Should correctly parse perfectly aligned double message from socket<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>                self<span class="k">.</span>bytesRead <span class="k">=</span> <span class="s">0</span><span class="k">;</span></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse perfectly aligned message from socket<br/><br/>test/connection/message_parser_test.js :: Should correctly parse perfectly aligned double message from socket<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>                self<span class="k">.</span>stubBuffer <span class="k">=</span> <span class="k">null</span><span class="k">;</span></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse perfectly aligned message from socket<br/><br/>test/connection/message_parser_test.js :: Should correctly parse perfectly aligned double message from socket<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>                <span class="c">// Exit parsing loop</span></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse perfectly aligned message from socket<br/><br/>test/connection/message_parser_test.js :: Should correctly parse perfectly aligned double message from socket<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>                data <span class="k">=</span> <span class="k">new</span> Buffer<span class="k">(</span><span class="s">0</span><span class="k">);</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>                <span class="c">// Emit the message</span></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse perfectly aligned message from socket<br/><br/>test/connection/message_parser_test.js :: Should correctly parse perfectly aligned double message from socket<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>                self<span class="k">.</span>emit<span class="k">(</span><span class="s">"message"</span><span class="k">,</span> emitBuffer<span class="k">,</span> self<span class="k">);</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>              <span class="k">}</span> <span class="k">catch</span> <span class="k">(</span>err<span class="k">)</span> <span class="k">{</span></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse perfectly aligned message from socket<br/><br/>test/connection/message_parser_test.js :: Should correctly parse perfectly aligned double message from socket<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>                <span class="k">var</span> errorObject <span class="k">=</span> <span class="k">{</span>err<span class="k">:</span><span class="s">"socketHandler"</span><span class="k">,</span> trace<span class="k">:</span>err<span class="k">,</span> bin<span class="k">:</span>self<span class="k">.</span>buffer<span class="k">,</span> parseState<span class="k">:</span><span class="k">{</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>                  sizeOfMessage<span class="k">:</span>self<span class="k">.</span>sizeOfMessage<span class="k">,</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>                  bytesRead<span class="k">:</span>self<span class="k">.</span>bytesRead<span class="k">,</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>                  stubBuffer<span class="k">:</span>self<span class="k">.</span>stubBuffer<span class="k">}}</span><span class="k">;</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>                <span class="k">if</span><span class="k">(</span>self<span class="k">.</span>logger <span class="k">!=</span> <span class="k">null</span> <span class="k">&amp;&amp;</span> self<span class="k">.</span>logger<span class="k">.</span>doError<span class="k">)</span> self<span class="k">.</span>logger<span class="k">.</span>error<span class="k">(</span><span class="s">"parseError"</span><span class="k">,</span> errorObject<span class="k">);</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>                <span class="c">// We got a parse Error fire it off then keep going</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>                self<span class="k">.</span>emit<span class="k">(</span><span class="s">"parseError"</span><span class="k">,</span> errorObject<span class="k">,</span> self<span class="k">);</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>              <span class="k">}</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>            <span class="k">}</span> <span class="k">else</span> <span class="k">if</span><span class="k">(</span>sizeOfMessage <span class="k">&lt;=</span> <span class="s">4</span> <span class="k">||</span> sizeOfMessage <span class="k">&gt;</span> self<span class="k">.</span>maxBsonSize<span class="k">)</span> <span class="k">{</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>              <span class="k">var</span> errorObject <span class="k">=</span> <span class="k">{</span>err<span class="k">:</span><span class="s">"socketHandler"</span><span class="k">,</span> trace<span class="k">:</span><span class="k">null</span><span class="k">,</span> bin<span class="k">:</span>data<span class="k">,</span> parseState<span class="k">:</span><span class="k">{</span></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse perfectly aligned double message from socket<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>                sizeOfMessage<span class="k">:</span>sizeOfMessage<span class="k">,</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>                bytesRead<span class="k">:</span><span class="s">0</span><span class="k">,</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>                buffer<span class="k">:</span><span class="k">null</span><span class="k">,</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>                stubBuffer<span class="k">:</span><span class="k">null</span><span class="k">}}</span><span class="k">;</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>              <span class="k">if</span><span class="k">(</span>self<span class="k">.</span>logger <span class="k">!=</span> <span class="k">null</span> <span class="k">&amp;&amp;</span> self<span class="k">.</span>logger<span class="k">.</span>doError<span class="k">)</span> self<span class="k">.</span>logger<span class="k">.</span>error<span class="k">(</span><span class="s">"parseError"</span><span class="k">,</span> errorObject<span class="k">);</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>              <span class="c">// We got a parse Error fire it off then keep going</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>              self<span class="k">.</span>emit<span class="k">(</span><span class="s">"parseError"</span><span class="k">,</span> errorObject<span class="k">,</span> self<span class="k">);</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>              <span class="c">// Clear out the state of the parser</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>              self<span class="k">.</span>buffer <span class="k">=</span> <span class="k">null</span><span class="k">;</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>              self<span class="k">.</span>sizeOfMessage <span class="k">=</span> <span class="s">0</span><span class="k">;</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>              self<span class="k">.</span>bytesRead <span class="k">=</span> <span class="s">0</span><span class="k">;</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>              self<span class="k">.</span>stubBuffer <span class="k">=</span> <span class="k">null</span><span class="k">;</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>              <span class="c">// Exit parsing loop</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>              data <span class="k">=</span> <span class="k">new</span> Buffer<span class="k">(</span><span class="s">0</span><span class="k">);</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>            <span class="k">}</span> <span class="k">else</span> <span class="k">{</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>              <span class="k">try</span> <span class="k">{</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>                <span class="k">var</span> emitBuffer <span class="k">=</span> data<span class="k">.</span>slice<span class="k">(</span><span class="s">0</span><span class="k">,</span> sizeOfMessage<span class="k">);</span></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse perfectly aligned double message from socket<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>                <span class="c">// Reset state of buffer</span></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse perfectly aligned double message from socket<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>                self<span class="k">.</span>buffer <span class="k">=</span> <span class="k">null</span><span class="k">;</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>                self<span class="k">.</span>sizeOfMessage <span class="k">=</span> <span class="s">0</span><span class="k">;</span></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse perfectly aligned double message from socket<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>                self<span class="k">.</span>bytesRead <span class="k">=</span> <span class="s">0</span><span class="k">;</span></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse perfectly aligned double message from socket<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>                self<span class="k">.</span>stubBuffer <span class="k">=</span> <span class="k">null</span><span class="k">;</span></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse perfectly aligned double message from socket<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>                <span class="c">// Copy rest of message</span></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse perfectly aligned double message from socket<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>                data <span class="k">=</span> data<span class="k">.</span>slice<span class="k">(</span>sizeOfMessage<span class="k">);</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>                <span class="c">// Emit the message</span></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse perfectly aligned double message from socket<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>                self<span class="k">.</span>emit<span class="k">(</span><span class="s">"message"</span><span class="k">,</span> emitBuffer<span class="k">,</span> self<span class="k">);</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>              <span class="k">}</span> <span class="k">catch</span> <span class="k">(</span>err<span class="k">)</span> <span class="k">{</span></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse perfectly aligned double message from socket<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>                <span class="k">var</span> errorObject <span class="k">=</span> <span class="k">{</span>err<span class="k">:</span><span class="s">"socketHandler"</span><span class="k">,</span> trace<span class="k">:</span>err<span class="k">,</span> bin<span class="k">:</span>self<span class="k">.</span>buffer<span class="k">,</span> parseState<span class="k">:</span><span class="k">{</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>                  sizeOfMessage<span class="k">:</span>sizeOfMessage<span class="k">,</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>                  bytesRead<span class="k">:</span>self<span class="k">.</span>bytesRead<span class="k">,</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>                  stubBuffer<span class="k">:</span>self<span class="k">.</span>stubBuffer<span class="k">}}</span><span class="k">;</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>                <span class="k">if</span><span class="k">(</span>self<span class="k">.</span>logger <span class="k">!=</span> <span class="k">null</span> <span class="k">&amp;&amp;</span> self<span class="k">.</span>logger<span class="k">.</span>doError<span class="k">)</span> self<span class="k">.</span>logger<span class="k">.</span>error<span class="k">(</span><span class="s">"parseError"</span><span class="k">,</span> errorObject<span class="k">);</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>                <span class="c">// We got a parse Error fire it off then keep going</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>                self<span class="k">.</span>emit<span class="k">(</span><span class="s">"parseError"</span><span class="k">,</span> errorObject<span class="k">,</span> self<span class="k">);</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>              <span class="k">}</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>            <span class="k">}</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>          <span class="k">}</span> <span class="k">else</span> <span class="k">{</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>            <span class="c">// Create a buffer that contains the space for the non-complete message</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>            self<span class="k">.</span>stubBuffer <span class="k">=</span> <span class="k">new</span> Buffer<span class="k">(</span>data<span class="k">.</span>length<span class="k">)</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>            <span class="c">// Copy the data to the stub buffer</span></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and smaller than 4 bytes additional one<br/><br/>test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and smaller than 4 bytes additional one then rest of the message<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>            data<span class="k">.</span>copy<span class="k">(</span>self<span class="k">.</span>stubBuffer<span class="k">,</span> <span class="s">0</span><span class="k">);</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>            <span class="c">// Exit parsing loop</span></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and smaller than 4 bytes additional one<br/><br/>test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and smaller than 4 bytes additional one then rest of the message<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>            data <span class="k">=</span> <span class="k">new</span> Buffer<span class="k">(</span><span class="s">0</span><span class="k">);</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>          <span class="k">}</span></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and smaller than 4 bytes additional one<br/><br/>test/connection/message_parser_test.js :: Should correctly parse message + in two packets from socket and smaller than 4 bytes additional one then rest of the message<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>        <span class="k">}</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>      <span class="k">}</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="k">}</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>  <span class="k">}</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code><span class="k">}</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code><span class="k">var</span> endHandler <span class="k">=</span> <span class="k">function</span><span class="k">(</span>self<span class="k">)</span> <span class="k">{</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>  <span class="k">return</span> <span class="k">function</span><span class="k">()</span> <span class="k">{</span></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse perfectly aligned message from socket<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="c">// Set connected to false</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    self<span class="k">.</span>connected <span class="k">=</span> <span class="k">false</span><span class="k">;</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="c">// Emit end event</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    self<span class="k">.</span>emit<span class="k">(</span><span class="s">"end"</span><span class="k">,</span> <span class="k">{</span>err<span class="k">:</span> <span class="s">'connection received Fin packet from ['</span> <span class="k">+</span> self<span class="k">.</span>socketOptions<span class="k">.</span>host <span class="k">+</span> <span class="s">':'</span> <span class="k">+</span> self<span class="k">.</span>socketOptions<span class="k">.</span>port <span class="k">+</span> <span class="s">']'</span><span class="k">}</span><span class="k">,</span> self<span class="k">);</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>  <span class="k">}</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code><span class="k">}</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code><span class="k">var</span> timeoutHandler <span class="k">=</span> <span class="k">function</span><span class="k">(</span>self<span class="k">)</span> <span class="k">{</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>  <span class="k">return</span> <span class="k">function</span><span class="k">()</span> <span class="k">{</span></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse perfectly aligned message from socket<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    self<span class="k">.</span>emit<span class="k">(</span><span class="s">"timeout"</span><span class="k">,</span> <span class="k">{</span>err<span class="k">:</span> <span class="s">'connection to ['</span> <span class="k">+</span> self<span class="k">.</span>socketOptions<span class="k">.</span>host <span class="k">+</span> <span class="s">':'</span> <span class="k">+</span> self<span class="k">.</span>socketOptions<span class="k">.</span>port <span class="k">+</span> <span class="s">'] timed out'</span><span class="k">}</span><span class="k">,</span> self<span class="k">);</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>  <span class="k">}</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code><span class="k">}</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code><span class="k">var</span> drainHandler <span class="k">=</span> <span class="k">function</span><span class="k">(</span>self<span class="k">)</span> <span class="k">{</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>  <span class="k">return</span> <span class="k">function</span><span class="k">()</span> <span class="k">{</span></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse perfectly aligned message from socket<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>  <span class="k">}</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code><span class="k">}</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code><span class="k">var</span> errorHandler <span class="k">=</span> <span class="k">function</span><span class="k">(</span>self<span class="k">)</span> <span class="k">{</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>  <span class="k">return</span> <span class="k">function</span><span class="k">(</span>err<span class="k">)</span> <span class="k">{</span></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse perfectly aligned message from socket<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="c">// Set connected to false</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    self<span class="k">.</span>connected <span class="k">=</span> <span class="k">false</span><span class="k">;</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="c">// Emit error</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    self<span class="k">.</span>emit<span class="k">(</span><span class="s">"error"</span><span class="k">,</span> <span class="k">{</span>err<span class="k">:</span> <span class="s">'failed to connect to ['</span> <span class="k">+</span> self<span class="k">.</span>socketOptions<span class="k">.</span>host <span class="k">+</span> <span class="s">':'</span> <span class="k">+</span> self<span class="k">.</span>socketOptions<span class="k">.</span>port <span class="k">+</span> <span class="s">']'</span><span class="k">}</span><span class="k">,</span> self<span class="k">);</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>  <span class="k">}</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code><span class="k">}</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code><span class="k">var</span> closeHandler <span class="k">=</span> <span class="k">function</span><span class="k">(</span>self<span class="k">)</span> <span class="k">{</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>  <span class="k">return</span> <span class="k">function</span><span class="k">(</span>hadError<span class="k">)</span> <span class="k">{</span></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse perfectly aligned message from socket<br/><br/>
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="c">// If we have an error during the connection phase</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="k">if</span><span class="k">(</span>hadError <span class="k">&amp;&amp;</span> <span class="k">!</span>self<span class="k">.</span>connected<span class="k">)</span> <span class="k">{</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>      <span class="c">// Set disconnected</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>      self<span class="k">.</span>connected <span class="k">=</span> <span class="k">false</span><span class="k">;</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>      <span class="c">// Emit error</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>      self<span class="k">.</span>emit<span class="k">(</span><span class="s">"error"</span><span class="k">,</span> <span class="k">{</span>err<span class="k">:</span> <span class="s">'failed to connect to ['</span> <span class="k">+</span> self<span class="k">.</span>socketOptions<span class="k">.</span>host <span class="k">+</span> <span class="s">':'</span> <span class="k">+</span> self<span class="k">.</span>socketOptions<span class="k">.</span>port <span class="k">+</span> <span class="s">']'</span><span class="k">}</span><span class="k">,</span> self<span class="k">);</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="k">}</span> <span class="k">else</span> <span class="k">{</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>      <span class="c">// Set disconnected</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>      self<span class="k">.</span>connected <span class="k">=</span> <span class="k">false</span><span class="k">;</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>      <span class="c">// Emit close</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>      self<span class="k">.</span>emit<span class="k">(</span><span class="s">"close"</span><span class="k">,</span> <span class="k">{</span>err<span class="k">:</span> <span class="s">'connection closed to ['</span> <span class="k">+</span> self<span class="k">.</span>socketOptions<span class="k">.</span>host <span class="k">+</span> <span class="s">':'</span> <span class="k">+</span> self<span class="k">.</span>socketOptions<span class="k">.</span>port <span class="k">+</span> <span class="s">']'</span><span class="k">}</span><span class="k">,</span> self<span class="k">);</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>    <span class="k">}</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>  <span class="k">}</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code><span class="k">}</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code><span class="c">// Some basic defaults</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code>Connection<span class="k">.</span>DEFAULT_PORT <span class="k">=</span> <span class="s">27017</span><span class="k">;</span></code></pre>
      </td>
      <td width="25%">
      </td>
    </tr>
    <tr>
      <td width="75%">
        <pre><code></code></pre>
      </td>
      <td width="25%">test/connection/message_parser_test.js :: Should correctly parse perfectly aligned message from socket<br/><br/>
      </td>
    </tr>
  </table>
</body>